<style>
  .fluent-form-stepper {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    position: relative;
    padding-left: 40px;
    border-left: 3px solid #ffb81c;
    font-family: "Arial", sans-serif;
  }

  .fluent-form-step {
    position: relative;
    margin-bottom: 30px;
    cursor: pointer;
    opacity: 0.5;
    transition: opacity 0.3s;
  }

  .fluent-form-step.active {
    opacity: 1 !important; /* Force full opacity when active */
  }

  .fluent-form-step::before {
    content: "";
    position: absolute;
    left: -21px;
    top: 2px;
    width: 24px;
    height: 24px;
    background-color: #ffb81c;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .fluent-form-step-title {
    font-size: 14px;
    color: #999;
    font-weight: bold;
    margin-bottom: 4px;
  }

  .fluent-form-step-label {
    font-size: 16px;
    color: #003366;
    font-weight: 700;
  }

  .fluent-form-step:hover .fluent-form-step-label {
    text-decoration: underline;
  }

  @media (max-width: 768px) {
    .fluent-form-stepper {
      padding-left: 30px;
    }

    .fluent-form-step::before {
      width: 20px;
      height: 20px;
      left: -18px;
    }
  }
</style>

<div class="fluent-form-stepper">
  <div class="fluent-form-step active" id="step-1">
    <div class="fluent-form-step-title">Étape 1</div>
    <div class="fluent-form-step-label">Informations personnelles</div>
  </div>
  <div class="fluent-form-step" id="step-2">
    <div class="fluent-form-step-title">Étape 2</div>
    <div class="fluent-form-step-label">Critères de sélection</div>
  </div>
  <div class="fluent-form-step" id="step-3">
    <div class="fluent-form-step-title">Étape 3</div>
    <div class="fluent-form-step-label">Études et expérience</div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Get all step elements and the form container
    const steps = document.querySelectorAll(".fluent-form-step");
    const formContainer = document.querySelector(".fluent_form_90");

    if (!formContainer) {
      console.error("Form container not found!");
      return;
    }

    // Add click event listener to each step
    steps.forEach(function (step, index) {
      step.addEventListener("click", function () {
        // Find the custom HTML element with the ID we need
        let targetElement;

        if (index === 0) {
          targetElement = formContainer.querySelector(".user_data_part_one");
        } else if (index === 1) {
          targetElement = formContainer.querySelector(".user_data_part_two");
        } else if (index === 2) {
          targetElement = formContainer.querySelector(".user_data_part_three");
        }

        if (targetElement) {
          console.log("Found target element:", targetElement);

          // Set this step as active
          steps.forEach((s) => s.classList.remove("active"));
          this.classList.add("active");

          // Calculate scroll position
          const offset = 30;
          const targetPosition = targetElement.offsetTop - offset;

          console.log("Scrolling to position:", targetPosition);

          // Scroll to the element
          formContainer.scrollTo({
            top: targetPosition,
            behavior: "smooth",
          });
        } else {
          console.error("Target element not found for step", index + 1);
        }
      });
    });

    // Observe scroll position to update active step
    let lastKnownScrollPosition = 0;
    let ticking = false;

    formContainer.addEventListener("scroll", function () {
      lastKnownScrollPosition = formContainer.scrollTop;

      if (!ticking) {
        window.requestAnimationFrame(function () {
          updateActiveStep(lastKnownScrollPosition);
          ticking = false;
        });

        ticking = true;
      }
    });

    function updateActiveStep(scrollPos) {
      // Find all custom HTML elements that mark the sections
      const section1 = formContainer.querySelector(".user_data_part_one");
      const section2 = formContainer.querySelector(".user_data_part_two");
      const section3 = formContainer.querySelector(".user_data_part_three");

      if (!section1 || !section2 || !section3) {
        console.error("One or more section markers not found!");
        return;
      }

      // Get positions
      const pos1 = section1.offsetTop;
      const pos2 = section2.offsetTop;
      const pos3 = section3.offsetTop;

      console.log("Scroll position:", scrollPos);
      console.log("Section positions:", pos1, pos2, pos3);

      // Determine active section with 50px threshold
      if (scrollPos >= pos3 - 50) {
        setActiveStep(2); // Step 3
      } else if (scrollPos >= pos2 - 50) {
        setActiveStep(1); // Step 2
      } else {
        setActiveStep(0); // Step 1
      }
    }

    function setActiveStep(index) {
      steps.forEach((step, i) => {
        if (i === index) {
          step.classList.add("active");
        } else {
          step.classList.remove("active");
        }
      });
    }

    // Set first step as active by default
    setActiveStep(0);
  });
</script>
