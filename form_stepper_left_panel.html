<style>
  /* ====================
         Variables
      ==================== */
  :root {
    --primary-yellow: #ffb81c;
    --primary-blue: #003366;
    --active-blue: #002244;
    --gray: #999;
    --light-gray: #666;
    --error: #ff0000;
    --icon-size: 40px;
    --step-gap: 30px;
    --transition-duration: 0.3s;
  }

  /* ====================
         Stepper Container
      ==================== */
  .fluent-form-stepper {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    justify-content: center;
    position: relative;
    font-family: "Arial", sans-serif;
    height: 640px;
    max-height: 640px;
    background-color: white;
    padding-left: 15px;
    border-radius: 25px;
    border: 5px solid #f7f7f7;
  }

  /* ====================
         Step Block
      ==================== */
  .fluent-form-step {
    position: relative;
    margin-bottom: var(--step-gap);
    display: flex;
    flex-direction: row;
    align-items: center;
    width: 100%;
    gap: 5%;
    z-index: 20; /* Increased from 10 to ensure steps are above connecting lines */
    transition: all var(--transition-duration) ease;
  }

  .fluent-form-step.active {
    z-index: 25; /* Increased to ensure active step is prominently displayed */
  }

  /* ====================
         Step Icon
      ==================== */
  .iconDiv {
    background-color: var(--primary-yellow);
    width: var(--icon-size);
    height: var(--icon-size);
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 0.7;
    position: relative;
    padding-left: 7px !important;
    padding: 5px;
    transition: opacity var(--transition-duration) ease;
    z-index: 30 !important;
  }

  .fluent-form-step.active .iconDiv {
    opacity: 1 !important;
  }

  .imgIcons {
    width: 80% !important;
    height: 70%;
    z-index: 35 !important; /* Increased to ensure icon images are above everything */
    position: relative;
  }

  /* ====================
         Step Content
      ==================== */
  .fluent-form-step-content {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    position: relative;
    z-index: 25; /* Added to ensure text is above connecting lines */
  }

  .fluent-form-step-title {
    font-size: 14px;
    color: var(--gray);
    font-weight: bold;
    margin-bottom: 4px;
    position: relative;
    top: -5px;
    transition: color var(--transition-duration) ease;
  }

  .fluent-form-step-label {
    font-size: 16px;
    color: var(--primary-blue);
    font-weight: 700;
    text-align: left;
    transition: color var(--transition-duration) ease;
  }

  .fluent-form-step.active .fluent-form-step-title {
    color: var(--light-gray);
  }

  .fluent-form-step.active .fluent-form-step-label {
    color: var(--active-blue);
  }

  /* ====================
         Validation & Errors
      ==================== */
  .ff-el-group.has-error .ff-el-control-wrapper input,
  .ff-el-group.has-error .ff-el-control-wrapper select,
  .ff-el-group.has-error .ff-el-control-wrapper textarea,
  .ff-el-group.has-error .ff-el-control-wrapper .ff_file_upload_holder {
    border-color: var(--error) !important;
  }

  .ff-el-group.has-error .ff-el-input-label {
    color: var(--error) !important;
  }

  .form-error-message {
    color: var(--error);
    font-size: 14px;
    margin-top: 5px;
    display: none;
  }

  .form-error-message.show {
    display: block;
  }

  /* ====================
         Horizontal Line Connector
      ==================== */

  #step-connector {
    position: relative;
    border: 0;
    width: 120px;
    border-top: 3px solid var(--primary-yellow);
    border-radius: 50px;
    transform: rotate(90deg);
    left: -40px;
    top: 107px;
    opacity: 0.2;
    z-index: 5 !important;
    transition: opacity 0.3s ease;
  }

  /* ==================
        IMG OF INDEED
    ==================*/
  #img_indeed_avis_container {
    background-color: white;
  }
  #img_indeed_avis {
    height: auto;
    object-fit: cover;
  }

  #bottom_img_left_side_panel {
    margin-top: 20px; /* Added margin to separate from steps */
    max-width: 100%; /* Ensure image doesn't overflow container */
  }

  /* ====================
         Responsive (Mobile)
      ==================== */
  @media (max-width: 768px) {
    .fluent-form-stepper {
      padding-left: 30px;
    }

    .step-connector {
      left: 14px; /* Adjust for smaller padding on mobile */
    }
  }
</style>
<link
  rel="preload"
  as="image"
  href="https://tutorax.com/wp-content/uploads/2025/04/Draft-Formulaire-recrutement_pic_below.png"
/>
<link
  rel="preload"
  as="image"
  href="https://tutorax.com/wp-content/uploads/2025/04/Draft-Formulaire-recrutement_pic_below_step_3.png"
/>

<div class="fluent-form-stepper">
  <hr id="step-connector" />

  <!-- Step 1 -->
  <div class="fluent-form-step active" id="step-1" data-step-index="0">
    <div class="iconDiv">
      <img
        class="imgIcons"
        src="https://tutorax.com/wp-content/uploads/2025/04/Draft-Formulaire-recrutement.svg"
        alt=""
      />
    </div>
    <div class="fluent-form-step-content">
      <div class="fluent-form-step-title">√âtape 1</div>
      <div class="fluent-form-step-label">Informations personnelles</div>
    </div>
  </div>

  <!-- Step 2 -->
  <div
    class="fluent-form-step fluent-form-step2"
    id="step-2"
    data-step-index="1"
  >
    <div class="iconDiv">
      <img
        class="imgIcons"
        src="https://tutorax.com/wp-content/uploads/2025/04/Draft-Formulaire-recrutement1.svg"
        alt=""
      />
    </div>
    <div class="fluent-form-step-content">
      <div class="fluent-form-step-title">√âtape 2</div>
      <div class="fluent-form-step-label">Crit√®res de s√©lection</div>
    </div>
  </div>

  <!-- Step 3 -->
  <div
    class="fluent-form-step fluent-form-step3"
    id="step-3"
    data-step-index="2"
  >
    <div class="iconDiv">
      <img
        class="imgIcons"
        src="https://tutorax.com/wp-content/uploads/2025/04/Draft-Formulaire-recrutement3.svg"
        alt=""
      />
    </div>
    <div class="fluent-form-step-content">
      <div class="fluent-form-step-title">√âtape 3</div>
      <div class="fluent-form-step-label">√âtudes et exp√©rience</div>
    </div>
  </div>
  <div id="img_indeed_avis_container">
    <img id="bottom_img_left_side_panel" src="" alt="" />
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    console.log("Custom Fluent Form script loaded");

    const steps = document.querySelectorAll(".fluent-form-step");
    const formContainer = document.querySelector(".fluent_form_90");

    // Create error message element if it doesn't exist
    let errorMessage = document.getElementById("form-error-message");
    if (!errorMessage && formContainer) {
      errorMessage = document.createElement("div");
      errorMessage.id = "form-error-message";
      errorMessage.className = "form-error-message";
      formContainer.insertBefore(errorMessage, formContainer.firstChild);
    }

    // Safety check for form container
    if (!formContainer) {
      console.error(
        "Form container not found! Make sure the selector is correct."
      );
      return;
    }

    const nextButtons = formContainer.querySelectorAll(".ff-btn-next");
    const prevButtons = formContainer.querySelectorAll(".ff-btn-prev");
    const stepSections = Array.from(
      formContainer.querySelectorAll(".ff-step-body")
    );

    // Update step image based on current step index
    function updateStepImage(index) {
      const img = document.getElementById("bottom_img_left_side_panel");
      if (!img) return;

      const images = [
        "https://tutorax.com/wp-content/uploads/2025/04/Visuels-Tutorax-2025-04-18T183536.333.png",
        "https://tutorax.com/wp-content/uploads/2025/04/Visuels-Tutorax-2025-04-18T180103.156.png",
        "https://tutorax.com/wp-content/uploads/2025/04/Visuels-Tutorax-2025-04-21T130452.980.png",
      ];

      if (images[index]) {
        img.src = images[index];
      }
    }

    // Show floating error message
    function showErrorMessage(message) {
      if (!errorMessage) return;
      errorMessage.textContent = message;
      errorMessage.classList.add("show");
      setTimeout(() => errorMessage.classList.remove("show"), 5000);
    }

    // Get currently visible step's index
    function getCurrentVisibleStepIndex() {
      for (let i = 0; i < stepSections.length; i++) {
        if (stepSections[i].offsetParent !== null) {
          updateStepImage(i);
          return i;
        }
      }
      return 0;
    }

    // Update active and completed step UI
    function updateActiveStepUI(index) {
      steps.forEach((step, i) => {
        step.classList.remove("active", "completed");
        if (i < index) step.classList.add("completed");
        if (i === index) step.classList.add("active");
      });

      // üî• Modify the connector opacity based on active step
      const connector = document.getElementById("step-connector");
      if (connector) {
        connector.style.opacity = index === 1 ? "1" : "0.2"; // Full opacity when Step 2 is active
      }
    }

    // Validate required fields in current step
    function validateStep(stepElement) {
      if (!stepElement) return true;

      const requiredFields = stepElement.querySelectorAll(
        "input[required], select[required], textarea[required], " +
          'input[data-required="yes"], select[data-required="yes"], textarea[data-required="yes"]'
      );

      stepElement.querySelectorAll(".has-error").forEach((el) => {
        el.classList.remove("has-error");
      });

      let isValid = true;
      let firstInvalid = null;

      requiredFields.forEach((field) => {
        if (field.offsetParent === null) return;

        let valid = true;

        if (["radio", "checkbox"].includes(field.type)) {
          const checked =
            formContainer.querySelectorAll(
              `input[name="${field.name}"]:checked`
            ).length > 0;
          valid = checked;
        } else if (field.type === "file") {
          valid = field.files.length > 0;
        } else if (field.tagName === "SELECT") {
          valid = field.value !== "" && field.value !== "-1";
        } else {
          valid = field.value.trim() !== "";
        }

        if (!valid) {
          const group = field.closest(".ff-el-group, .ff-el-input--content");
          if (group) group.classList.add("has-error");
          if (isValid) firstInvalid = field;
          isValid = false;
        }
      });

      if (firstInvalid) {
        setTimeout(() => {
          const container = firstInvalid.closest(
            ".ff-el-group, .ff_file_upload_holder"
          );
          (container || firstInvalid).scrollIntoView({
            behavior: "smooth",
            block: "center",
          });
          try {
            firstInvalid.focus();
          } catch (_) {}
        }, 300);
      }

      return isValid;
    }

    // Fix for step 3 submission issue
    const formElement = formContainer.querySelector("form");
    if (formElement) {
      const originalSubmit = formElement.onsubmit;
      formElement.onsubmit = function (e) {
        const currentIndex = getCurrentVisibleStepIndex();

        // If we're on the third step, validate fields
        if (currentIndex === 2) {
          if (!validateStep(stepSections[currentIndex])) {
            e.preventDefault();
            showErrorMessage(
              "Veuillez remplir tous les champs obligatoires avant de soumettre."
            );
            return false;
          }
        }

        return originalSubmit ? originalSubmit.apply(this, arguments) : true;
      };
    }

    // Add validation to submit button
    const submitButton = formContainer.querySelector(".ff-btn-submit");
    if (submitButton) {
      const originalClick = submitButton.onclick;
      submitButton.onclick = function (e) {
        const currentIndex = getCurrentVisibleStepIndex();

        if (currentIndex === 2) {
          if (!validateStep(stepSections[currentIndex])) {
            e.preventDefault();
            showErrorMessage(
              "Veuillez remplir tous les champs obligatoires avant de soumettre."
            );
            return false;
          }
        }

        return originalClick ? originalClick.apply(this, arguments) : true;
      };
    }

    // Sync step indicators after clicking next
    nextButtons.forEach((btn, i) => {
      btn.addEventListener("click", () => {
        setTimeout(() => {
          updateActiveStepUI(i + 1);
          updateStepImage(i + 1);
        }, 300);
      });
    });

    // Sync step indicators after clicking previous
    prevButtons.forEach((btn, i) => {
      btn.addEventListener("click", () => {
        setTimeout(() => {
          updateActiveStepUI(i);
          updateStepImage(i);
        }, 300);
      });
    });

    // Initial setup
    setTimeout(() => {
      const currentIndex = getCurrentVisibleStepIndex();
      updateActiveStepUI(currentIndex);
      updateStepImage(currentIndex);
    }, 500);
  });
</script>
