<style>
  /* ====================
         Variables
      ==================== */
  :root {
    --primary-yellow: #ffb81c;
    --primary-blue: #003366;
    --active-blue: #002244;
    --gray: #999;
    --light-gray: #666;
    --error: #ff0000;
    --icon-size: 40px;
    --step-gap: 30px;
    --transition-duration: 0.3s;
  }

  /* ====================
         Stepper Container
      ==================== */
  .fluent-form-stepper {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    justify-content: center;
    position: relative;
    font-family: "Arial", sans-serif;
    height: 640px;
    max-height: 640px;
    background-color: white;
    margin-left: 80px;
    margin-right: 15px;
  }

  /* ====================
         Step Block
      ==================== */
  .fluent-form-step {
    position: relative;
    margin-bottom: var(--step-gap);
    display: flex;
    flex-direction: row;
    align-items: center;
    width: 100%;
    gap: 5%;
    z-index: 20; /* Increased from 10 to ensure steps are above connecting lines */
    transition: all var(--transition-duration) ease;
  }

  .fluent-form-step.active {
    z-index: 25; /* Increased to ensure active step is prominently displayed */
  }

  /* ====================
         Step Icon
      ==================== */
  .iconDiv {
    background-color: var(--primary-yellow);
    width: var(--icon-size);
    height: var(--icon-size);
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 0.5;
    position: relative;
    padding-left: 7px !important;
    padding: 5px;
    transition: opacity var(--transition-duration) ease;
    z-index: 30 !important;
    margin-left: 15px;
  }

  .fluent-form-step.active .iconDiv {
    opacity: 1 !important;
  }

  .imgIcons {
    width: 80% !important;
    height: 70%;
    z-index: 35 !important; /* Increased to ensure icon images are above everything */
    position: relative;
  }

  /* ====================
     Step Content
  ==================== */
  .fluent-form-step-content {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    position: relative;
    z-index: 25; /* Ensure text is above connecting lines */
    opacity: 0.7; /* Default low opacity */
    transition: opacity var(--transition-duration) ease;
  }
  .fluent-form-step-content:hover {
    cursor: pointer;
  }

  .fluent-form-step.active .fluent-form-step-content {
    opacity: 1; /* Full opacity when step is active */
  }

  .fluent-form-step-title {
    font-size: 14px;
    color: var(--gray);
    font-weight: bold;
    margin-bottom: 4px;
    position: relative;
    transition: color var(--transition-duration) ease;
  }

  .fluent-form-step-label {
    font-size: 16px;
    color: var(--primary-blue);
    font-weight: 700;
    text-align: left;
    transition: color var(--transition-duration) ease;
  }

  .fluent-form-step.active .fluent-form-step-title {
    color: var(--light-gray);
  }

  .fluent-form-step.active .fluent-form-step-label {
    color: var(--active-blue);
  }

  /* ====================
         Validation & Errors
      ==================== */
  .ff-el-group.has-error .ff-el-control-wrapper input,
  .ff-el-group.has-error .ff-el-control-wrapper select,
  .ff-el-group.has-error .ff-el-control-wrapper textarea,
  .ff-el-group.has-error .ff-el-control-wrapper .ff_file_upload_holder {
    border-color: var(--error) !important;
  }

  .ff-el-group.has-error .ff-el-input-label {
    color: var(--error) !important;
  }

  .form-error-message {
    color: var(--error);
    font-size: 14px;
    margin-top: 5px;
    display: none;
  }

  .form-error-message.show {
    display: block;
  }

  /* ====================
         Horizontal Line Connector
      ==================== */

  #step-connector {
    position: relative;
    border: 0;
    width: 120px;
    border-top: 3px solid var(--primary-yellow);
    border-radius: 50px;
    transform: rotate(90deg);
    left: -25px;
    top: 107px;
    opacity: 0.2;
    z-index: 5 !important;
    transition: opacity 0.3s ease;
  }

  /* ==================
        IMG OF INDEED
    ==================*/
  #img_indeed_avis_container {
    background-color: white;
    width: 95%;
    margin-left: 10px;
  }

  #bottom_img_left_side_panel {
    margin-top: 20px; /* Added margin to separate from steps */
    max-width: 100%; /* Ensure image doesn't overflow container */
    /* box-shadow: 1px 0px 6px 0px rgba(133, 133, 133, 0.75);
    -webkit-box-shadow: 1px 0px 6px 0px rgba(133, 133, 133, 0.75);
    -moz-box-shadow: 1px 0px 6px 0px rgba(133, 133, 133, 0.75);*/
    border-radius: 10px;
  }

  #fluent-form-subContainer {
    box-shadow: 0px 0px 5px 5px rgba(153, 153, 153, 0.2);
    -webkit-box-shadow: 0px 0px 5px 5px rgba(153, 153, 153, 0.2);
    -moz-box-shadow: 0px 0px 5px 5px rgba(153, 153, 153, 0.2);
    padding-top: 95px;
    padding-bottom: 35px;
    border-radius: 5px;
  }

  /* ====================
         Responsive (Mobile)
      ==================== */
  @media (max-width: 768px) {
    .fluent-form-stepper {
      padding-left: 30px;
    }

    .step-connector {
      left: 14px; /* Adjust for smaller padding on mobile */
    }
  }
  @media (max-width: 1200px) {
    .fluent-form-stepper {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: center;
      position: relative;
      font-family: "Arial", sans-serif;
      height: 640px;
      max-height: 640px;
      background-color: white;
      margin-left: 30px;
      margin-right: 15px;
    }
  }
</style>
<link
  rel="preload"
  as="image"
  href="https://tutorax.com/wp-content/uploads/2025/04/Draft-Formulaire-recrutement_pic_below.png"
/>
<link
  rel="preload"
  as="image"
  href="https://tutorax.com/wp-content/uploads/2025/04/Draft-Formulaire-recrutement_pic_below_step_3.png"
/>

<div class="fluent-form-stepper">
  <div id="fluent-form-subContainer">
    <hr id="step-connector" />

    <!-- Step 1 -->
    <div class="fluent-form-step active" id="step-1" data-step-index="0">
      <div class="iconDiv">
        <img
          class="imgIcons"
          src="https://tutorax.com/wp-content/uploads/2025/04/Draft-Formulaire-recrutement.svg"
          alt=""
        />
      </div>
      <div class="fluent-form-step-content">
        <div class="fluent-form-step-title">Étape 1</div>
        <div class="fluent-form-step-label">Informations personnelles</div>
      </div>
    </div>

    <!-- Step 2 -->
    <div
      class="fluent-form-step fluent-form-step2"
      id="step-2"
      data-step-index="1"
    >
      <div class="iconDiv">
        <img
          class="imgIcons"
          src="https://tutorax.com/wp-content/uploads/2025/04/Draft-Formulaire-recrutement1.svg"
          alt=""
        />
      </div>
      <div class="fluent-form-step-content">
        <div class="fluent-form-step-title">Étape 2</div>
        <div class="fluent-form-step-label">Critères de sélection</div>
      </div>
    </div>

    <!-- Step 3 -->
    <div
      class="fluent-form-step fluent-form-step3"
      id="step-3"
      data-step-index="2"
    >
      <div class="iconDiv">
        <img
          class="imgIcons"
          src="https://tutorax.com/wp-content/uploads/2025/04/Draft-Formulaire-recrutement3.svg"
          alt=""
        />
      </div>
      <div class="fluent-form-step-content">
        <div class="fluent-form-step-title">Étape 3</div>
        <div class="fluent-form-step-label">Études et expérience</div>
      </div>
    </div>
    <div id="img_indeed_avis_container">
      <img id="bottom_img_left_side_panel" src="" alt="" />
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    console.log("Custom Fluent Form script loaded");

    const steps = document.querySelectorAll(".fluent-form-step");
    const formContainer = document.querySelector(".fluent_form_90");
    const stepSections = Array.from(document.querySelectorAll(".ff-step-body"));

    const stepMapping = {
      "step_start-90_9": 1,
      "form_step-90_3": 2,
      "form_step-90_5": 3,
      "form_step-90_8": 4,
    };

    const stepImages = {
      1: "https://tutorax.com/wp-content/uploads/2025/04/Draft-Formulaire-recrutement.png",
      2: "https://tutorax.com/wp-content/uploads/2025/04/Draft-Formulaire-recrutement-1.png",
      3: "https://tutorax.com/wp-content/uploads/2025/04/Draft-Formulaire-recrutement-2.png",
      4: "https://tutorax.com/wp-content/uploads/2025/04/Draft-Formulaire-recrutement-2.png",
    };

    function getCurrentStepIndex() {
      const activeStep = document.querySelector(".fluentform-step.active");
      if (!activeStep) return null;
      const dataName = activeStep.getAttribute("data-name");
      return stepMapping[dataName] || null;
    }

    function updateStepImage(counter) {
      const img = document.getElementById("bottom_img_left_side_panel");
      if (img && stepImages[counter]) {
        img.src = stepImages[counter];
      }
    }

    function updateActiveStepUI(counter) {
      steps.forEach((step, i) => {
        step.classList.remove("active", "completed");
        if (i < counter - 1) step.classList.add("completed");
        if (i === counter - 1) step.classList.add("active");
      });

      const connector = document.getElementById("step-connector");
      if (connector) {
        connector.style.opacity = counter === 2 ? "1" : "0.2";
      }
    }

    // function onStepChange() {
    //   const index = getCurrentStepIndex();
    //   if (!index) return;
    //   console.log("Step changed! Current index:", index);
    //   updateStepImage(index);
    //   updateActiveStepUI(index);
    // }

    function setupStepObserver() {
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (
            mutation.attributeName === "class" &&
            mutation.target.classList.contains("active")
          ) {
            onStepChange();
          }
        });
      });

      const allSteps = document.querySelectorAll(".fluentform-step");
      allSteps.forEach((step) => {
        observer.observe(step, {
          attributes: true,
          attributeFilter: ["class"],
        });
      });

      console.log(
        "Observer set up successfully for",
        allSteps.length,
        "step elements"
      );
      return observer;
    }

    // Setup observer
    setupStepObserver();

    // Initial call
    setTimeout(onStepChange, 500);
    let currentStepIndex = null; // Track current index globally

    function onStepChange() {
      const index = getCurrentStepIndex();
      if (!index) return;
      console.log("Step changed! Current index:", index);
      currentStepIndex = index - 1; // Because data-step-index is 0-based
      updateStepImage(index);
      updateActiveStepUI(index);
    }

    // Handle clicks on .fluent-form-step-content
    document
      .querySelectorAll(".fluent-form-step-content")
      .forEach((contentDiv) => {
        contentDiv.addEventListener("click", function (e) {
          const stepEl = contentDiv.closest(".fluent-form-step");
          if (!stepEl) return;

          const targetIndex = parseInt(stepEl.getAttribute("data-step-index"));
          if (isNaN(targetIndex)) return;

          if (currentStepIndex === null) return; // StepObserver hasn't run yet

          if (targetIndex > currentStepIndex) {
            console.log(`User clicked forward to step ${targetIndex + 1}`);
            const nextBtn = document.querySelector(".ff-btn-next");
            if (nextBtn) nextBtn.click();
          } else if (targetIndex < currentStepIndex) {
            console.log(`User clicked backward to step ${targetIndex + 1}`);
            const prevBtn = document.querySelector(".ff-btn-prev");
            if (prevBtn) prevBtn.click();
          } else {
            console.log("Clicked current step – no navigation.");
          }
        });
      });
  });
</script>
